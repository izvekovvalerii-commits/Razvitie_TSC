<div class="dashboard-page">
    <!-- Welcome Banner -->
    <div class="welcome-banner">
        <div class="welcome-content">
            <h1>–î–æ–±—Ä—ã–π –¥–µ–Ω—å, {{ (currentUser?.name || '').split(' ')[0] }}!</h1>
            <div class="welcome-meta-row">
                <div class="live-clock">{{ currentTime | date:'HH:mm' }}</div>
                <div class="live-date">{{ currentTime | date:'d MMMM yyyy' }}</div>
                <div class="live-divider">‚Ä¢</div>
                <div class="tasks-count">–£ –≤–∞—Å {{ activeTasks.length }} –∑–∞–¥–∞—á –≤ —Ä–∞–±–æ—Ç–µ</div>
            </div>
        </div>
        <div class="quick-actions">
            <button class="action-btn primary" routerLink="/projects">
                <span class="icon">üèóÔ∏è</span> –ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç
            </button>
        </div>
    </div>

    <!-- KPI Cards Grid -->
    <div class="kpi-grid">
        <!-- Projects -->
        <div class="kpi-card purple" (click)="navigateToProjects()">
            <div class="kpi-icon-bg">üè¢</div>
            <div class="kpi-content">
                <div class="kpi-value">{{ projectStats.total }}</div>
                <div class="kpi-label">–í—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–æ–≤</div>
            </div>
        </div>
        <!-- New Tasks -->
        <div class="kpi-card blue" (click)="navigateToTasksWithFilter('–ù–∞–∑–Ω–∞—á–µ–Ω–∞')">
            <div class="kpi-icon-bg">üîî</div>
            <div class="kpi-content">
                <div class="kpi-value">{{ newTasks.length }}</div>
                <div class="kpi-label">–ù–æ–≤—ã–µ –∑–∞–¥–∞—á–∏</div>
            </div>
        </div>
        <!-- Active Tasks -->
        <div class="kpi-card green" (click)="navigateToTasksWithFilter('–í —Ä–∞–±–æ—Ç–µ')">
            <div class="kpi-icon-bg">‚ö°</div>
            <div class="kpi-content">
                <div class="kpi-value">{{ activeTasks.length }}</div>
                <div class="kpi-label">–í —Ä–∞–±–æ—Ç–µ</div>
            </div>
        </div>
        <!-- Overdue -->
        <div class="kpi-card orange" (click)="navigateToOverdueTasks()">
            <div class="kpi-icon-bg">üî•</div>
            <div class="kpi-content">
                <div class="kpi-value">{{ overdueCount }}</div>
                <div class="kpi-label">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</div>
            </div>
        </div>
        <!-- Expiring Soon -->
        <div class="kpi-card yellow" (click)="navigateToExpiringSoonTasks()">
            <div class="kpi-icon-bg">‚è∞</div>
            <div class="kpi-content">
                <div class="kpi-value">{{ expiringSoonCount }}</div>
                <div class="kpi-label">–ò—Å—Ç–µ–∫–∞—é—Ç</div>
            </div>
        </div>
    </div>

    <div class="dashboard-split">
        <!-- Left Main Column -->
        <div class="main-column">
            <!-- Projects Charts / Status -->
            <div class="content-block stats-block">
                <div class="block-header-modern">
                    <h3>–°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–æ–≤</h3>
                    <a routerLink="/projects" class="link-simple">–í—Å–µ –ø—Ä–æ–µ–∫—Ç—ã ‚Üí</a>
                </div>
                <div class="stats-content">
                    <div class="chart-container">
                        <!-- Pie Chart Ring -->
                        <div class="pie-chart" *ngIf="projectStats.total > 0"
                            [style.background]="'conic-gradient(#4caf50 0% ' + (projectStats.active/projectStats.total*100) + '%, #ff9800 ' + (projectStats.active/projectStats.total*100) + '% ' + ((projectStats.active+projectStats.planning)/projectStats.total*100) + '%, #f44336 ' + ((projectStats.active+projectStats.planning)/projectStats.total*100) + '% 100%)'">
                            <div class="pie-hole">
                                <div class="pie-total">{{ projectStats.total }}</div>
                                <div class="pie-label">–ü—Ä–æ–µ–∫—Ç–æ–≤</div>
                            </div>
                        </div>
                        <div class="chart-empty" *ngIf="projectStats.total === 0">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>
                    </div>

                    <!-- Detailed Stats List -->
                    <div class="detailed-stats-list">
                        <div class="stat-row" *ngFor="let stat of detailedStats">
                            <div class="stat-row-header">
                                <div class="stat-name-group">
                                    <span class="dot" [style.background]="stat.color"></span>
                                    <span class="stat-name">{{ stat.name }}</span>
                                </div>
                                <div class="stat-val-group">
                                    <span class="stat-val">{{ stat.count }}</span>
                                    <span class="stat-percent">{{ stat.percent }}%</span>
                                </div>
                            </div>
                            <div class="stat-progress-bg">
                                <div class="stat-progress-bar" [style.width.%]="stat.percent"
                                    [style.background]="stat.color"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tasks List -->
            <div class="content-block tasks-list-block">
                <div class="block-header-modern">
                    <h3>–ú–æ–∏ –∑–∞–¥–∞—á–∏</h3>
                    <a routerLink="/tasks" class="link-simple">–í—Å–µ –∑–∞–¥–∞—á–∏ ‚Üí</a>
                </div>
                <div class="task-list-modern">
                    <div *ngFor="let task of myTasks | slice:0:6" class="task-row"
                        [routerLink]="['/projects', task.projectId]">
                        <div class="task-status-line" [ngClass]="getStatusClass(task.status)"></div>
                        <div class="task-main-info">
                            <div class="task-title">{{ task.name }}</div>
                            <div class="task-meta">
                                <span>#{{ task.projectId }}</span> ‚Ä¢ <span>{{ task.taskType }}</span>
                            </div>
                        </div>
                        <div class="task-right">
                            <div class="task-deadline-badge" [class.urgent]="getDaysUntilDeadline(task).isUrgent"
                                [class.overdue]="getDaysUntilDeadline(task).isOverdue">
                                {{ getDaysUntilDeadline(task).text }}
                            </div>
                        </div>
                    </div>
                    <div *ngIf="myTasks.length === 0" class="empty-text">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á</div>
                </div>
            </div>
        </div>

        <!-- Right Side Column -->
        <div class="side-column">
            <!-- Activity Feed -->
            <div class="content-block activity-feed-block">
                <div class="block-header-modern">
                    <h3>–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h3>
                </div>
                <div class="activity-feed">
                    <div *ngFor="let activity of recentActivities | slice:0:10" class="feed-item">
                        <div class="feed-avatar" [style.background]="getRoleColor(activity.userRole)">
                            {{ activity.userName.charAt(0) }}
                        </div>
                        <div class="feed-content">
                            <div class="feed-text">
                                <strong>{{ activity.userName }}</strong> {{ activity.action }}
                            </div>
                            <div class="feed-project-name" *ngIf="activity.projectName">{{ activity.projectName }}</div>
                            <a [routerLink]="['/projects', activity.projectId]" class="feed-link">{{ activity.taskName
                                }}</a>
                            <div class="feed-time">{{ getTimeAgo(activity.timestamp) }}</div>
                        </div>
                    </div>
                    <div *ngIf="recentActivities.length === 0" class="empty-text">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</div>
                </div>
            </div>
        </div>
    </div>
</div>