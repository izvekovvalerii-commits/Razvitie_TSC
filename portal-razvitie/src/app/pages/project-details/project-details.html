<div class="project-details-page">
    <!-- Header with Back Button and Store Info -->
    <header class="page-header">
        <div class="header-main-row">
            <button class="btn-back" (click)="goBack()">‚Üê –ù–∞–∑–∞–¥</button>
            <h1>{{ project?.store?.name }}</h1>

            <!-- Store Information Inline -->
            <div class="header-info-inline">
                <div class="info-item-inline">
                    <label>–ö–û–î –ì–ò–°</label>
                    <span class="value highlight">{{ project?.gisCode }}</span>
                </div>
                <div class="info-item-inline">
                    <label>–†–ï–ì–ò–û–ù</label>
                    <span class="value">{{ project?.region || project?.store?.region }}</span>
                </div>
                <div class="info-item-inline">
                    <label>–ê–î–†–ï–°</label>
                    <span class="value">{{ project?.address || project?.store?.address }}</span>
                </div>
                <div class="info-item-inline">
                    <label>–ü–õ–û–©–ê–î–¨</label>
                    <span class="value highlight">{{ project?.totalArea || project?.store?.totalArea }} –º¬≤</span>
                </div>
            </div>

            <!-- Status Badge with Custom Dropdown -->
            <div class="status-wrapper" *ngIf="project">
                <div class="custom-status-dropdown" (click)="toggleStatusDropdown()">
                    <div class="status-current" [style.background]="getStatusColor(project.status)"
                        [class.yellow-status]="project.status === '–ê—É–¥–∏—Ç'">
                        {{ project.status }}
                    </div>
                    <div class="status-dropdown-menu" *ngIf="statusDropdownOpen">
                        <div *ngFor="let status of projectStatuses" class="status-option"
                            [class.selected]="project.status === status"
                            (click)="selectStatus(status); $event.stopPropagation()">
                            <span class="check-icon" *ngIf="project.status === status">‚úì</span>
                            {{ status }}
                        </div>
                    </div>
                </div>
            </div>

            <button class="btn-delete-project" (click)="deleteProject()" title="–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç">üóëÔ∏è</button>
        </div>
    </header>

    <div class="loading-spinner" *ngIf="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

    <div class="project-content" *ngIf="!loading && project">

        <div class="project-main-grid">

            <!-- Sidebar Column (Left) -->
            <div class="sidebar-column">
                <!-- Team -->
                <div class="info-card">
                    <h3 class="section-title" style="display:flex; align-items:center; gap:8px;">
                        <span style="font-size: 18px;">üë•</span> –ö–æ–º–∞–Ω–¥–∞ –ø—Ä–æ–µ–∫—Ç–∞
                    </h3>
                    <div class="responsible-list" style="display: flex; flex-direction: column; gap: 8px;">
                        <div class="team-card" *ngFor="let member of projectTeam"
                            style="display: flex; align-items: center; gap: 12px; padding: 10px; background: white; border: 1px solid #e2e8f0; border-radius: 8px;">
                            <div class="member-avatar" [style.background-color]="member.color"
                                style="width: 36px; height: 36px; border-radius: 50%; color: white; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 14px; flex-shrink: 0;">
                                {{ member.initials }}
                            </div>
                            <div class="member-info" style="display: flex; flex-direction: column; flex: 1;">
                                <div style="font-weight: 600; font-size: 14px; color: #1e293b;">{{ member.name }}</div>
                                <div
                                    style="font-size: 12px; color: #64748b; display: flex; align-items: center; gap: 6px;">
                                    <span
                                        style="background: #f1f5f9; padding: 2px 6px; border-radius: 4px; font-weight: 500;">{{
                                        member.role }}</span>
                                    <span>‚Ä¢</span>
                                    <span>{{ member.phone }}</span>
                                </div>
                            </div>
                        </div>

                        <div class="no-data" *ngIf="projectTeam.length === 0"
                            style="padding: 15px; color: #94a3b8; font-size: 12px; text-align: center; border: 1px dashed #cbd5e1; border-radius: 6px; background: #f8fafc;">
                            –ù–µ—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö
                        </div>
                    </div>
                </div>

                <!-- Documents -->
                <div class="info-card">
                    <div class="card-header-flex"
                        style="margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center;">
                        <h3 class="section-title" style="margin: 0; display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 18px;">üìÇ</span> –î–æ–∫—É–º–µ–Ω—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞
                        </h3>
                        <button class="btn-primary small" (click)="fileInput.click()"
                            style="width: 28px; height: 28px; padding: 0; display: flex; align-items: center; justify-content: center; border-radius: 6px; font-size: 18px; line-height: 1;">+</button>
                        <input #fileInput type="file" (change)="onFileSelected($event); uploadDocument()"
                            style="display:none">
                    </div>

                    <div class="docs-list" *ngIf="documents.length > 0"
                        style="display: flex; flex-direction: column; gap: 8px;">
                        <div class="attachment-item" *ngFor="let doc of documents"
                            style="padding: 8px 10px; border: 1px solid #e2e8f0; border-radius: 6px; background:#fff; align-items: center;">
                            <div class="attachment-info" style="gap: 10px; flex: 1; min-width: 0;">
                                <span class="file-icon" style="font-size: 16px; color: #64748b;">üìÑ</span>
                                <span class="file-name" (click)="downloadDoc(doc)"
                                    style="font-size: 13px; cursor: pointer; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">{{
                                    doc.name }}</span>
                            </div>
                            <button class="btn-delete-doc" (click)="deleteDoc(doc)" title="–£–¥–∞–ª–∏—Ç—å"
                                style="width: 24px; height: 24px; font-size: 18px; margin-left: 8px;">√ó</button>
                        </div>
                    </div>

                    <div class="no-data" *ngIf="documents.length === 0"
                        style="padding: 15px; color: #94a3b8; font-size: 12px; text-align: center; border: 1px dashed #cbd5e1; border-radius: 6px; background: #f8fafc;">
                        –ù–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
                    </div>
                </div>
            </div>

            <!-- Main Column (Right) -->
            <div class="main-column">
                <!-- Gantt Chart Section -->
                <div class="info-card gantt-wrapper">
                    <div class="card-header-flex" style="justify-content: space-between; flex-wrap: wrap; gap: 10px;">
                        <div style="display:flex; align-items:center; gap:16px;">
                            <h3 class="section-title" style="margin:0; white-space: nowrap;">üìä –ì—Ä–∞—Ñ–∏–∫</h3>

                            <!-- View Mode Switcher (Segmented Control) -->
                            <div class="gantt-view-switcher" *ngIf="isGanttExpanded">
                                <button [class.active]="ganttViewMode === 'day'"
                                    (click)="setGanttViewMode('day')">–î–µ–Ω—å</button>
                                <button [class.active]="ganttViewMode === 'week'"
                                    (click)="setGanttViewMode('week')">–ù–µ–¥–µ–ª—è</button>
                                <button [class.active]="ganttViewMode === 'month'"
                                    (click)="setGanttViewMode('month')">–ú–µ—Å—è—Ü</button>
                                <button [class.active]="ganttViewMode === 'quarter'"
                                    (click)="setGanttViewMode('quarter')">–ö–≤–∞—Ä—Ç–∞–ª</button>
                            </div>
                        </div>

                        <div style="display:flex; align-items:center; gap: 16px;">
                            <div class="legend" *ngIf="isGanttExpanded">
                                <span class="legend-item"><span class="dot planned"></span> –ü–ª–∞–Ω</span>
                                <span class="legend-item"><span class="dot active"></span> –í —Ä–∞–±–æ—Ç–µ</span>
                                <span class="legend-item"><span class="dot done"></span> –ì–æ—Ç–æ–≤–æ</span>
                            </div>
                            <button class="btn-toggle-gantt" (click)="toggleGantt()" title="–°–≤–µ—Ä–Ω—É—Ç—å/–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å">
                                {{ isGanttExpanded ? '‚ñ≤' : '‚ñº' }}
                            </button>
                        </div>
                    </div>

                    <div class="gantt-scroll-area inline-gantt" *ngIf="ganttDates.length > 0 && isGanttExpanded">
                        <!-- Header -->
                        <div class="gantt-header-row">
                            <div class="gantt-col-name">–ó–∞–¥–∞—á–∞</div>
                            <div class="gantt-timeline-header">
                                <div class="date-col" *ngFor="let d of ganttDates" [class.today-col]="isToday(d)"
                                    [style.min-width.px]="ganttViewMode === 'day' ? 30 : (ganttViewMode === 'week' ? 40 : (ganttViewMode === 'month' ? 60 : 80))"
                                    [style.width.px]="ganttViewMode === 'day' ? 30 : (ganttViewMode === 'week' ? 40 : (ganttViewMode === 'month' ? 60 : 80))">

                                    <ng-container *ngIf="ganttViewMode === 'day'">
                                        {{ d | date:'dd' }}<br>
                                        <span class="month-label">{{ getMonthLabel(d) }}</span>
                                    </ng-container>

                                    <ng-container *ngIf="ganttViewMode === 'week'">
                                        <span class="month-label">–ù{{ d | date:'w' }}</span><br>
                                        {{ d | date:'dd.MM' }}
                                    </ng-container>

                                    <ng-container *ngIf="ganttViewMode === 'month'">
                                        <span class="month-label">{{ getMonthLabel(d) }}</span><br>
                                        {{ d | date:'yyyy' }}
                                    </ng-container>

                                    <ng-container *ngIf="ganttViewMode === 'quarter'">
                                        <span class="month-label">Q{{ (d.getMonth() / 3) + 1 }}</span><br>
                                        {{ d | date:'yyyy' }}
                                    </ng-container>
                                </div>
                            </div>
                        </div>
                        <!-- Rows -->
                        <!-- Rows Container -->
                        <div class="gantt-body-container" style="position: relative;">
                            <!-- Dependency Lines SVG -->
                            <svg class="gantt-links-overlay" [attr.height]="ganttTasks.length * 41"
                                preserveAspectRatio="none" [attr.viewBox]="'0 0 100 ' + (ganttTasks.length * 41)">
                                <path *ngFor="let line of getTaskConnections()" [attr.d]="line" fill="none"
                                    stroke="#bbb" stroke-width="2" vector-effect="non-scaling-stroke"></path>
                            </svg>

                            <div class="gantt-body-row" *ngFor="let task of ganttTasks">
                                <div class="gantt-col-name" [title]="task.name">
                                    {{ task.name }}
                                </div>
                                <div class="gantt-timeline-row">
                                    <div class="gantt-grid-cell" *ngFor="let d of ganttDates"
                                        [class.today-col]="isToday(d)"
                                        [style.min-width.px]="ganttViewMode === 'day' ? 30 : (ganttViewMode === 'week' ? 40 : (ganttViewMode === 'month' ? 60 : 80))"
                                        [style.width.px]="ganttViewMode === 'day' ? 30 : (ganttViewMode === 'week' ? 40 : (ganttViewMode === 'month' ? 60 : 80))">
                                    </div>
                                    <div class="gantt-bar" [style.left.%]="getTaskLeftPercent(task)"
                                        [style.width.%]="getTaskWidthPercent(task)"
                                        [ngClass]="getTaskStatusClass(task.status)"
                                        [title]="task.name + '\n' + (task.normativeDeadline | date:'dd.MM.yyyy')"
                                        (click)="openGanttTaskInfo(task)">
                                        <span class="bar-label">{{ getTaskDuration(task) }} –¥–Ω.</span>
                                    </div>
                                    <div *ngIf="getTaskDeviation(task) as dev"
                                        [style.left.%]="getTaskLeftPercent(task) + getTaskWidthPercent(task)"
                                        [style.color]="dev.type === 'early' ? '#10B981' : '#EF4444'"
                                        style="position: absolute; top: 50%; transform: translateY(-50%); margin-left: 8px; font-size: 10px; font-weight: bold; white-space: nowrap; z-index: 5; pointer-events: none;">
                                        {{ dev.type === 'early' ? '+' : '-' }}{{ dev.days }}
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                    <div *ngIf="ganttDates.length === 0" class="no-data">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞</div>
                </div>

                <!-- Active Tasks List -->
                <div class="info-card tasks-card">
                    <div class="card-header-flex">
                        <div style="display:flex; align-items:center; gap:12px;">
                            <h3 class="section-title" style="margin:0;">‚úÖ –ó–ê–î–ê–ß–ò</h3>
                            <button class="btn-toggle-gantt" (click)="toggleTasksView()" title="–°–≤–µ—Ä–Ω—É—Ç—å/–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å">
                                {{ showAllTasks ? '‚ñ≤' : '‚ñº' }}
                            </button>
                        </div>
                        <div class="header-actions">
                            <div class="tasks-count-badge">{{ displayedTasks.length }}</div>
                        </div>
                    </div>

                    <div class="tasks-table-wrapper" *ngIf="displayedTasks.length > 0">
                        <div class="tasks-table-header">
                            <div class="col-task-name">–ó–∞–¥–∞—á–∞</div>
                            <div class="col-responsible">–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π</div>
                            <div class="col-deadline">–ü–ª–∞–Ω–æ–≤—ã–π —Å—Ä–æ–∫</div>
                            <div class="col-deadline">–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Å—Ä–æ–∫</div>
                            <div class="col-deviation">–û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ</div>
                            <div class="col-status">–°—Ç–∞—Ç—É—Å</div>
                        </div>
                        <div class="tasks-table-body">
                            <div class="task-row" *ngFor="let task of displayedTasks"
                                [class.row-clickable]="canEditTask(task)">
                                <div class="col-task-name">
                                    <div class="task-name-wrapper">
                                        <span class="task-name-text"
                                            (click)="canEditTask(task) && openEditTaskModal(task)">
                                            {{ task.name }}
                                        </span>
                                        <button *ngIf="canEditTask(task)" class="btn-edit-icon"
                                            (click)="openEditTaskModal(task)" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úé</button>
                                    </div>
                                </div>
                                <div class="col-responsible">
                                    <div class="responsible-wrapper">
                                        <span class="resp-icon">üë§</span>
                                        <span>{{ getResponsibleDisplay(task) }}</span>
                                    </div>
                                </div>
                                <div class="col-deadline">
                                    <div class="deadline-wrapper">
                                        <span class="deadline-icon">üìÖ</span>
                                        <span>{{ task.normativeDeadline | date:'dd.MM.yyyy' }}</span>
                                    </div>
                                </div>
                                <div class="col-deadline">
                                    <div class="deadline-wrapper">
                                        <span class="deadline-icon" *ngIf="task.actualDate">‚úÖ</span>
                                        <span [class.text-muted]="!task.actualDate">
                                            {{ task.actualDate ? (task.actualDate | date:'dd.MM.yyyy') : '‚Äî' }}
                                        </span>
                                    </div>
                                </div>
                                <div class="col-deviation">
                                    <span *ngIf="getTaskDeviation(task)" class="deviation-badge"
                                        [class.early]="getTaskDeviation(task)?.type === 'early'"
                                        [class.late]="getTaskDeviation(task)?.type === 'late'">
                                        <span *ngIf="getTaskDeviation(task)?.type === 'early'">
                                            ‚úì {{ getTaskDeviation(task)?.days }} –¥–Ω.
                                        </span>
                                        <span *ngIf="getTaskDeviation(task)?.type === 'late'">
                                            ‚ö† {{ getTaskDeviation(task)?.days }} –¥–Ω.
                                        </span>
                                    </span>
                                    <span *ngIf="!getTaskDeviation(task)" class="text-muted">‚Äî</span>
                                </div>
                                <div class="col-status">
                                    <span class="status-badge" [ngClass]="getTaskStatusClass(task.status)">
                                        {{ task.status }}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="no-tasks" *ngIf="displayedTasks.length === 0">
                        <div class="no-tasks-icon">üìã</div>
                        <div class="no-tasks-text">–ù–µ—Ç –∑–∞–¥–∞—á –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<!-- Modals -->
<!-- Create Task Modal -->
<div class="modal-overlay" *ngIf="showCreateTaskModal" (click)="closeCreateTaskModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
        <h2>–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞</h2>
        <div class="form-group">
            <label>–¢–∏–ø</label>
            <select [(ngModel)]="newTask.taskType" (change)="onTaskTypeChange()">
                <option *ngFor="let t of taskTypes" [value]="t">{{ t }}</option>
            </select>
        </div>
        <div class="form-group">
            <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
            <input [(ngModel)]="newTask.name">
        </div>
        <div class="form-group">
            <label>–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π</label>
            <input [(ngModel)]="newTask.responsible">
        </div>
        <div class="form-group">
            <label>–°—Ä–æ–∫</label>
            <input type="date" [(ngModel)]="newTask.normativeDeadline">
        </div>
        <div class="modal-actions">
            <button (click)="closeCreateTaskModal()">–û—Ç–º–µ–Ω–∞</button>
            <button class="btn-primary" (click)="createTask()">–°–æ–∑–¥–∞—Ç—å</button>
        </div>
    </div>
</div>

<!-- Edit Task Modal -->
<div class="modal-overlay" *ngIf="showEditTaskModal" (click)="closeEditTaskModal()">
    <div class="modal-content large-modal" (click)="$event.stopPropagation()">
        <div class="modal-header" style="display:flex; justify-content:space-between; align-items:center;">
            <h2>{{ selectedTask?.name }}</h2>
            <button class="btn-close-modal" (click)="closeEditTaskModal()"
                style="background:none; border:none; font-size:24px; cursor:pointer; color:#999;">√ó</button>
        </div>

        <div class="modal-form-grid" *ngIf="selectedTask">
            <!-- Dependency Box -->
            <div class="dependency-box">
                <div class="dep-item">
                    <span class="dep-label">–ü—Ä–µ–¥—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫</span>
                    <span class="dep-value">{{ prevTaskNames }}</span>
                </div>
                <div class="dep-item">
                    <span class="dep-label">–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å</span>
                    <span class="dep-value">{{ nextTaskNames }}</span>
                </div>
            </div>

            <!-- Main Info (Name removed as it is in header) -->
            <div class="form-section-title">–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</div>

            <div class="field-group">
                <label>–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π</label>
                <input type="text" [(ngModel)]="selectedTask.responsible" class="modern-input" readonly>
            </div>

            <div class="field-group">
                <label>–°—Ç–∞—Ç—É—Å</label>
                <select [(ngModel)]="selectedTask.status" class="modern-input modern-select">
                    <option *ngFor="let s of taskStatuses" [value]="s">{{s}}</option>
                </select>
            </div>

            <!-- Timeline Group -->
            <div class="form-section-title">–°—Ä–æ–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</div>

            <div class="field-group">
                <label>–ü–ª–∞–Ω–æ–≤—ã–π —Å—Ä–æ–∫</label>
                <input type="date" [ngModel]="selectedTask.normativeDeadline | date:'yyyy-MM-dd'"
                    (ngModelChange)="selectedTask.normativeDeadline = $event" class="modern-input" readonly>
            </div>

            <div class="field-group">
                <label>–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Å—Ä–æ–∫</label>
                <input type="date" [ngModel]="selectedTask.actualDate | date:'yyyy-MM-dd'"
                    (ngModelChange)="selectedTask.actualDate = $event" class="modern-input" readonly>
                <small class="field-hint">–ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏</small>
            </div>

            <!-- Deviation (if evident) -->
            <div class="field-group full-width" *ngIf="getTaskDeviation(selectedTask)">
                <label>–û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—Ç –ø–ª–∞–Ω–∞</label>
                <div class="deviation-display" [class.early]="getTaskDeviation(selectedTask)?.type === 'early'"
                    [class.late]="getTaskDeviation(selectedTask)?.type === 'late'">
                    <span *ngIf="getTaskDeviation(selectedTask)?.type === 'early'">
                        ‚úì –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ä–∞–Ω—å—à–µ –Ω–∞ {{ getTaskDeviation(selectedTask)?.days }} –¥–Ω.
                    </span>
                    <span *ngIf="getTaskDeviation(selectedTask)?.type === 'late'">
                        ‚ö† –ó–∞–¥–µ—Ä–∂–∫–∞ –Ω–∞ {{ getTaskDeviation(selectedTask)?.days }} –¥–Ω.
                    </span>
                </div>
            </div>

            <!-- Custom Audit Fields -->
            <ng-container *ngIf="selectedTask.name === '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∞—É–¥–∏—Ç—É'">
                <div class="form-section-title">–ê—É–¥–∏—Ç</div>
                <div class="field-group">
                    <label>–ü–ª–∞–Ω–æ–≤–∞—è –¥–∞—Ç–∞ –∞—É–¥–∏—Ç–∞ <span class="required">*</span></label>
                    <input type="date" [ngModel]="selectedTask.plannedAuditDate | date:'yyyy-MM-dd'"
                        (ngModelChange)="selectedTask.plannedAuditDate = $event" class="modern-input">
                </div>
                <div class="field-group">
                    <label>–°—Å—ã–ª–∫–∞ –Ω–∞ –ø—Ä–æ–µ–∫—Ç <span class="required">*</span></label>
                    <input type="text" [(ngModel)]="selectedTask.projectFolderLink" placeholder="https://..."
                        class="modern-input">
                </div>
            </ng-container>

            <!-- Custom Audit Object Fields -->
            <ng-container *ngIf="selectedTask.name === '–ê—É–¥–∏—Ç –æ–±—ä–µ–∫—Ç–∞'">
                <div class="form-section-title">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞—É–¥–∏—Ç–∞</div>
                <div class="field-group">
                    <label>–§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –¥–∞—Ç–∞ –∞—É–¥–∏—Ç–∞ <span class="required">*</span></label>
                    <input type="date" [ngModel]="selectedTask.actualAuditDate | date:'yyyy-MM-dd'"
                        (ngModelChange)="selectedTask.actualAuditDate = $event" class="modern-input">
                </div>
            </ng-container>

            <!-- Custom Alcohol License Fields -->
            <ng-container *ngIf="selectedTask.name === '–ê–ª–∫–æ–≥–æ–ª—å–Ω–∞—è –ª–∏—Ü–µ–Ω–∑–∏—è'">
                <div class="form-section-title">–õ–∏—Ü–µ–Ω–∑–∏—è</div>
                <div class="field-group">
                    <label>–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–ª—É—á–µ–Ω–∏—è –∞–ª–∫–æ–≥–æ–ª—å–Ω–æ–π –ª–∏—Ü–µ–Ω–∑–∏–∏ <span class="required">*</span></label>
                    <select [(ngModel)]="selectedTask.alcoholLicenseEligibility" class="modern-input modern-select">
                        <option [ngValue]="undefined" disabled>–í—ã–±–µ—Ä–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ</option>
                        <option value="–î–∞">–î–∞</option>
                        <option value="–ù–µ—Ç">–ù–µ—Ç</option>
                    </select>
                </div>
            </ng-container>

            <!-- Custom TBO Fields -->
            <ng-container *ngIf="selectedTask.name === '–ü–ª–æ—â–∞–¥–∫–∞ –¢–ë–û'">
                <div class="form-section-title">–ü–ª–æ—â–∞–¥–∫–∞ –¢–ë–û</div>
                <div class="field-group">
                    <label>–°—Å—ã–ª–∫–∞ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç—ã –¥–ª—è –ø–ª–æ—â–∞–¥–∫–∏ –¢–ë–û <span class="required">*</span></label>
                    <input type="text" [(ngModel)]="selectedTask.tboDocsLink" placeholder="https://..."
                        class="modern-input">
                </div>
                <div class="field-group">
                    <label>–î–∞—Ç–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è <span class="required">*</span></label>
                    <input type="date" [ngModel]="selectedTask.tboAgreementDate | date:'yyyy-MM-dd'"
                        (ngModelChange)="selectedTask.tboAgreementDate = $event" class="modern-input">
                </div>
                <div class="field-group">
                    <label>–î–∞—Ç–∞ –≤–Ω–µ—Å–µ–Ω–∏—è –≤ –†–µ–µ—Å—Ç—Ä –¢–ë–û <span class="required">*</span></label>
                    <input type="date" [ngModel]="selectedTask.tboRegistryDate | date:'yyyy-MM-dd'"
                        (ngModelChange)="selectedTask.tboRegistryDate = $event" class="modern-input">
                </div>
            </ng-container>

            <!-- Custom Planning Contour Fields -->
            <ng-container *ngIf="selectedTask.name === '–ö–æ–Ω—Ç—É—Ä –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏'">
                <div class="form-section-title">–ö–æ–Ω—Ç—É—Ä –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏</div>

                <div class="field-group">
                    <label>–î–∞—Ç–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ç—É—Ä–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ <span class="required">*</span></label>
                    <input type="date" [ngModel]="selectedTask.planningContourAgreementDate | date:'yyyy-MM-dd'"
                        (ngModelChange)="selectedTask.planningContourAgreementDate = $event" class="modern-input">
                </div>

                <!-- 1. Object Photos -->
                <div class="full-width" style="margin-top: 16px;">
                    <div class="form-section-title" style="margin-bottom: 10px;">–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –æ–±—ä–µ–∫—Ç–∞ <span
                            class="required">*</span></div>

                    <div class="attachments-list" *ngIf="getDocsByType('–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –æ–±—ä–µ–∫—Ç–∞').length > 0">
                        <div *ngFor="let doc of getDocsByType('–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –æ–±—ä–µ–∫—Ç–∞')" class="attachment-item">
                            <div class="attachment-info">
                                <span class="file-icon">üñºÔ∏è</span>
                                <span class="file-name" (click)="downloadDoc(doc)">{{ doc.name }}</span>
                            </div>
                            <button class="btn-delete-doc" (click)="deleteDoc(doc)" title="–£–¥–∞–ª–∏—Ç—å">√ó</button>
                        </div>
                    </div>

                    <div class="upload-placeholder" (click)="photosInput.click()" style="margin-top: 10px;">
                        <div class="upload-icon">üì∑</div>
                        <div class="upload-text">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</div>
                        <div class="upload-subtext">–ú–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ</div>
                    </div>
                    <input #photosInput type="file" multiple (change)="onTaskFileSelected($event, '–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –æ–±—ä–µ–∫—Ç–∞')"
                        style="display:none">
                </div>

                <!-- 2. Measurement Plan (DWG Only) -->
                <div class="full-width" style="margin-top: 16px;">
                    <div class="form-section-title" style="margin-bottom: 10px;">–û–±–º–µ—Ä–Ω—ã–π –ø–ª–∞–Ω <span
                            class="required">*</span></div>

                    <div class="attachments-list" *ngIf="getDocsByType('–û–±–º–µ—Ä–Ω—ã–π –ø–ª–∞–Ω').length > 0">
                        <div *ngFor="let doc of getDocsByType('–û–±–º–µ—Ä–Ω—ã–π –ø–ª–∞–Ω')" class="attachment-item tech-plan">
                            <div class="attachment-info">
                                <span class="file-icon">üìê</span>
                                <span class="file-name" (click)="downloadDoc(doc)">{{ doc.name }}</span>
                            </div>
                            <button class="btn-delete-doc" (click)="deleteDoc(doc)" title="–£–¥–∞–ª–∏—Ç—å">√ó</button>
                        </div>
                    </div>

                    <div class="upload-placeholder" (click)="measurePlanInput.click()"
                        *ngIf="getDocsByType('–û–±–º–µ—Ä–Ω—ã–π –ø–ª–∞–Ω').length === 0">
                        <div class="upload-icon">üìê</div>
                        <div class="upload-text">–ó–∞–≥—Ä—É–∑–∏—Ç—å –û–±–º–µ—Ä–Ω—ã–π –ø–ª–∞–Ω</div>
                        <div class="upload-subtext">–¢–æ–ª—å–∫–æ .dwg</div>
                    </div>
                    <input #measurePlanInput type="file" accept=".dwg"
                        (change)="onTaskFileSelected($event, '–û–±–º–µ—Ä–Ω—ã–π –ø–ª–∞–Ω')" style="display:none">
                </div>

                <!-- 3. Preliminary Contour (DWG Only) -->
                <div class="full-width" style="margin-top: 16px;">
                    <div class="form-section-title" style="margin-bottom: 10px;">–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç—É—Ä –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ <span
                            class="required">*</span></div>

                    <div class="attachments-list" *ngIf="getDocsByType('–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç—É—Ä').length > 0">
                        <div *ngFor="let doc of getDocsByType('–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç—É—Ä')"
                            class="attachment-item tech-plan">
                            <div class="attachment-info">
                                <span class="file-icon">üèóÔ∏è</span>
                                <span class="file-name" (click)="downloadDoc(doc)">{{ doc.name }}</span>
                            </div>
                            <button class="btn-delete-doc" (click)="deleteDoc(doc)" title="–£–¥–∞–ª–∏—Ç—å">√ó</button>
                        </div>
                    </div>

                    <div class="upload-placeholder" (click)="prelimContourInput.click()"
                        *ngIf="getDocsByType('–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç—É—Ä').length === 0">
                        <div class="upload-icon">üèóÔ∏è</div>
                        <div class="upload-text">–ó–∞–≥—Ä—É–∑–∏—Ç—å –ö–æ–Ω—Ç—É—Ä</div>
                        <div class="upload-subtext">–¢–æ–ª—å–∫–æ .dwg</div>
                    </div>
                    <input #prelimContourInput type="file" accept=".dwg"
                        (change)="onTaskFileSelected($event, '–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç—É—Ä')" style="display:none">
                </div>
            </ng-container>

            <!-- Custom Visualization Fields -->
            <ng-container *ngIf="selectedTask.name === '–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è'">
                <div class="form-section-title">–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è</div>

                <div class="field-group">
                    <label>–î–∞—Ç–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ <span class="required">*</span></label>
                    <input type="date" [ngModel]="selectedTask.visualizationAgreementDate | date:'yyyy-MM-dd'"
                        (ngModelChange)="selectedTask.visualizationAgreementDate = $event" class="modern-input">
                </div>

                <!-- 1. Visualization Concept -->
                <div class="full-width" style="margin-top: 16px;">
                    <div class="form-section-title" style="margin-bottom: 10px;">–ö–æ–Ω—Ü–µ–ø—Ç –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ <span
                            class="required">*</span></div>

                    <div class="attachments-list" *ngIf="getDocsByType('–ö–æ–Ω—Ü–µ–ø—Ç –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏').length > 0">
                        <div *ngFor="let doc of getDocsByType('–ö–æ–Ω—Ü–µ–ø—Ç –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏')" class="attachment-item">
                            <div class="attachment-info">
                                <span class="file-icon">üé®</span>
                                <span class="file-name" (click)="downloadDoc(doc)">{{ doc.name }}</span>
                            </div>
                            <button class="btn-delete-doc" (click)="deleteDoc(doc)" title="–£–¥–∞–ª–∏—Ç—å">√ó</button>
                        </div>
                    </div>

                    <div class="upload-placeholder" (click)="conceptInput.click()"
                        *ngIf="getDocsByType('–ö–æ–Ω—Ü–µ–ø—Ç –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏').length === 0">
                        <div class="upload-icon">üé®</div>
                        <div class="upload-text">–ó–∞–≥—Ä—É–∑–∏—Ç—å –ö–æ–Ω—Ü–µ–ø—Ç</div>
                    </div>
                    <input #conceptInput type="file" (change)="onTaskFileSelected($event, '–ö–æ–Ω—Ü–µ–ø—Ç –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏')"
                        style="display:none">
                </div>

                <!-- 2. EGRN Extract -->
                <div class="full-width" style="margin-top: 16px;">
                    <div class="form-section-title" style="margin-bottom: 10px;">–í—ã–ø–∏—Å–∫–∞ –ï–ì–†–ù <span
                            class="required">*</span></div>

                    <div class="attachments-list" *ngIf="getDocsByType('–í—ã–ø–∏—Å–∫–∞ –ï–ì–†–ù').length > 0">
                        <div *ngFor="let doc of getDocsByType('–í—ã–ø–∏—Å–∫–∞ –ï–ì–†–ù')" class="attachment-item">
                            <div class="attachment-info">
                                <span class="file-icon">üìÑ</span>
                                <span class="file-name" (click)="downloadDoc(doc)">{{ doc.name }}</span>
                            </div>
                            <button class="btn-delete-doc" (click)="deleteDoc(doc)" title="–£–¥–∞–ª–∏—Ç—å">√ó</button>
                        </div>
                    </div>

                    <div class="upload-placeholder" (click)="egrnInput.click()"
                        *ngIf="getDocsByType('–í—ã–ø–∏—Å–∫–∞ –ï–ì–†–ù').length === 0">
                        <div class="upload-icon">üìÑ</div>
                        <div class="upload-text">–ó–∞–≥—Ä—É–∑–∏—Ç—å –í—ã–ø–∏—Å–∫—É</div>
                    </div>
                    <input #egrnInput type="file" (change)="onTaskFileSelected($event, '–í—ã–ø–∏—Å–∫–∞ –ï–ì–†–ù')"
                        style="display:none">
                </div>

                <!-- 3. Store Appearance -->
                <div class="full-width" style="margin-top: 16px;">
                    <div class="form-section-title" style="margin-bottom: 10px;">–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤–Ω–µ—à–Ω–µ–≥–æ –≤–∏–¥–∞ <span
                            class="required">*</span></div>

                    <div class="attachments-list"
                        *ngIf="getDocsByType('–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤–Ω–µ—à–Ω–µ–≥–æ –≤–∏–¥–∞ –º–∞–≥–∞–∑–∏–Ω–∞').length > 0">
                        <div *ngFor="let doc of getDocsByType('–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤–Ω–µ—à–Ω–µ–≥–æ –≤–∏–¥–∞ –º–∞–≥–∞–∑–∏–Ω–∞')"
                            class="attachment-item">
                            <div class="attachment-info">
                                <span class="file-icon">üè¨</span>
                                <span class="file-name" (click)="downloadDoc(doc)">{{ doc.name }}</span>
                            </div>
                            <button class="btn-delete-doc" (click)="deleteDoc(doc)" title="–£–¥–∞–ª–∏—Ç—å">√ó</button>
                        </div>
                    </div>

                    <div class="upload-placeholder" (click)="appearanceInput.click()"
                        *ngIf="getDocsByType('–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤–Ω–µ—à–Ω–µ–≥–æ –≤–∏–¥–∞ –º–∞–≥–∞–∑–∏–Ω–∞').length === 0">
                        <div class="upload-icon">üè¨</div>
                        <div class="upload-text">–ó–∞–≥—Ä—É–∑–∏—Ç—å –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é</div>
                    </div>
                    <input #appearanceInput type="file"
                        (change)="onTaskFileSelected($event, '–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤–Ω–µ—à–Ω–µ–≥–æ –≤–∏–¥–∞ –º–∞–≥–∞–∑–∏–Ω–∞')"
                        style="display:none">
                </div>
            </ng-container>

            <!-- Custom Logistics Assessment Fields -->
            <ng-container *ngIf="selectedTask.name === '–û—Ü–µ–Ω–∫–∞ –ª–æ–≥–∏—Å—Ç–∏–∫–∏'">
                <div class="form-section-title">–û—Ü–µ–Ω–∫–∞ –ª–æ–≥–∏—Å—Ç–∏–∫–∏</div>

                <div class="field-group">
                    <label>–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ù–ë–ö–ü <span class="required">*</span></label>
                    <select [(ngModel)]="selectedTask.logisticsNbkpEligibility" class="modern-input modern-select">
                        <option [ngValue]="undefined" disabled>–í—ã–±–µ—Ä–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ</option>
                        <option value="–î–∞">–î–∞</option>
                        <option value="–ù–µ—Ç">–ù–µ—Ç</option>
                    </select>
                </div>

                <!-- 1. Access Roads Scheme (Any format) -->
                <div class="full-width" style="margin-top: 16px;">
                    <div class="form-section-title" style="margin-bottom: 10px;">–°—Ö–µ–º–∞ –ø–æ–¥—ä–µ–∑–¥–Ω—ã—Ö –ø—É—Ç–µ–π <span
                            class="required">*</span></div>

                    <div class="attachments-list" *ngIf="getDocsByType('–°—Ö–µ–º–∞ –ø–æ–¥—ä–µ–∑–¥–Ω—ã—Ö –ø—É—Ç–µ–π').length > 0">
                        <div *ngFor="let doc of getDocsByType('–°—Ö–µ–º–∞ –ø–æ–¥—ä–µ–∑–¥–Ω—ã—Ö –ø—É—Ç–µ–π')" class="attachment-item">
                            <div class="attachment-info">
                                <span class="file-icon">üó∫Ô∏è</span>
                                <span class="file-name" (click)="downloadDoc(doc)">{{ doc.name }}</span>
                            </div>
                            <button class="btn-delete-doc" (click)="deleteDoc(doc)" title="–£–¥–∞–ª–∏—Ç—å">√ó</button>
                        </div>
                    </div>

                    <div class="upload-placeholder" (click)="accessRouteInput.click()">
                        <div class="upload-icon">üó∫Ô∏è</div>
                        <div class="upload-text">–ó–∞–≥—Ä—É–∑–∏—Ç—å –°—Ö–µ–º—É</div>
                        <div class="upload-subtext">–õ—é–±–æ–π —Ñ–æ—Ä–º–∞—Ç</div>
                    </div>
                    <input #accessRouteInput type="file" (change)="onTaskFileSelected($event, '–°—Ö–µ–º–∞ –ø–æ–¥—ä–µ–∑–¥–Ω—ã—Ö –ø—É—Ç–µ–π')"
                        style="display:none">
                </div>

                <!-- 2. Logistics Assessment (PDF Only) -->
                <div class="full-width" style="margin-top: 16px;">
                    <div class="form-section-title" style="margin-bottom: 10px;">–û—Ü–µ–Ω–∫–∞ –ª–æ–≥–∏—Å—Ç–∏–∫–∏ –∏ –ø–æ–¥—ä–µ–∑–¥–Ω—ã—Ö –ø—É—Ç–µ–π
                        <span class="required">*</span>
                    </div>

                    <div class="attachments-list"
                        *ngIf="getDocsByType('–û—Ü–µ–Ω–∫–∞ –ª–æ–≥–∏—Å—Ç–∏–∫–∏ –∏ –ø–æ–¥—ä–µ–∑–¥–Ω—ã—Ö –ø—É—Ç–µ–π').length > 0">
                        <div *ngFor="let doc of getDocsByType('–û—Ü–µ–Ω–∫–∞ –ª–æ–≥–∏—Å—Ç–∏–∫–∏ –∏ –ø–æ–¥—ä–µ–∑–¥–Ω—ã—Ö –ø—É—Ç–µ–π')"
                            class="attachment-item">
                            <div class="attachment-info">
                                <span class="file-icon">üìÑ</span>
                                <span class="file-name" (click)="downloadDoc(doc)">{{ doc.name }}</span>
                            </div>
                            <button class="btn-delete-doc" (click)="deleteDoc(doc)" title="–£–¥–∞–ª–∏—Ç—å">√ó</button>
                        </div>
                    </div>

                    <div class="upload-placeholder" (click)="logisticsAssesInput.click()"
                        *ngIf="getDocsByType('–û—Ü–µ–Ω–∫–∞ –ª–æ–≥–∏—Å—Ç–∏–∫–∏ –∏ –ø–æ–¥—ä–µ–∑–¥–Ω—ã—Ö –ø—É—Ç–µ–π').length === 0">
                        <div class="upload-icon">üìÑ</div>
                        <div class="upload-text">–ó–∞–≥—Ä—É–∑–∏—Ç—å –û—Ü–µ–Ω–∫—É</div>
                        <div class="upload-subtext">–¢–æ–ª—å–∫–æ PDF</div>
                    </div>
                    <input #logisticsAssesInput type="file" accept=".pdf"
                        (change)="onTaskFileSelected($event, '–û—Ü–µ–Ω–∫–∞ –ª–æ–≥–∏—Å—Ç–∏–∫–∏ –∏ –ø–æ–¥—ä–µ–∑–¥–Ω—ã—Ö –ø—É—Ç–µ–π')"
                        style="display:none">
                </div>

                <!-- 3. NBKP Assessment (PDF Only) -->
                <div class="full-width" style="margin-top: 16px;">
                    <div class="form-section-title" style="margin-bottom: 10px;">–û—Ü–µ–Ω–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ù–ë–ö–ü <span
                            class="required">*</span></div>

                    <div class="attachments-list" *ngIf="getDocsByType('–û—Ü–µ–Ω–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ù–ë–ö–ü').length > 0">
                        <div *ngFor="let doc of getDocsByType('–û—Ü–µ–Ω–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ù–ë–ö–ü')" class="attachment-item">
                            <div class="attachment-info">
                                <span class="file-icon">üöö</span>
                                <span class="file-name" (click)="downloadDoc(doc)">{{ doc.name }}</span>
                            </div>
                            <button class="btn-delete-doc" (click)="deleteDoc(doc)" title="–£–¥–∞–ª–∏—Ç—å">√ó</button>
                        </div>
                    </div>

                    <div class="upload-placeholder" (click)="nbkpInput.click()"
                        *ngIf="getDocsByType('–û—Ü–µ–Ω–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ù–ë–ö–ü').length === 0">
                        <div class="upload-icon">üöö</div>
                        <div class="upload-text">–ó–∞–≥—Ä—É–∑–∏—Ç—å –û—Ü–µ–Ω–∫—É –ù–ë–ö–ü</div>
                        <div class="upload-subtext">–¢–æ–ª—å–∫–æ PDF</div>
                    </div>
                    <input #nbkpInput type="file" accept=".pdf"
                        (change)="onTaskFileSelected($event, '–û—Ü–µ–Ω–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ù–ë–ö–ü')" style="display:none">
                </div>
            </ng-container>

            <!-- Custom Layout with Arrangement Fields -->
            <ng-container *ngIf="selectedTask.name === '–ü–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ —Å —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–æ–π'">
                <div class="form-section-title">–ü–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ —Å —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–æ–π</div>

                <div class="field-group">
                    <label>–î–∞—Ç–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ <span class="required">*</span></label>
                    <input type="date" [ngModel]="selectedTask.layoutAgreementDate | date:'yyyy-MM-dd'"
                        (ngModelChange)="selectedTask.layoutAgreementDate = $event" class="modern-input">
                </div>

                <!-- 1. Layout DWG -->
                <div class="full-width" style="margin-top: 16px;">
                    <div class="form-section-title" style="margin-bottom: 10px;">–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ —Å
                        —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–æ–π –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è (DWG) <span class="required">*</span></div>

                    <div class="attachments-list" *ngIf="getDocsByType('–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ (DWG)').length > 0">
                        <div *ngFor="let doc of getDocsByType('–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ (DWG)')"
                            class="attachment-item">
                            <div class="attachment-info">
                                <span class="file-icon">üìê</span>
                                <span class="file-name" (click)="downloadDoc(doc)">{{ doc.name }}</span>
                            </div>
                            <button class="btn-delete-doc" (click)="deleteDoc(doc)" title="–£–¥–∞–ª–∏—Ç—å">√ó</button>
                        </div>
                    </div>

                    <div class="upload-placeholder" (click)="layoutDwgInput.click()"
                        *ngIf="getDocsByType('–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ (DWG)').length === 0">
                        <div class="upload-icon">üìê</div>
                        <div class="upload-text">–ó–∞–≥—Ä—É–∑–∏—Ç—å –ü–ª–∞–Ω–∏—Ä–æ–≤–∫—É</div>
                        <div class="upload-subtext">–¢–æ–ª—å–∫–æ DWG</div>
                    </div>
                    <input #layoutDwgInput type="file" accept=".dwg"
                        (change)="onTaskFileSelected($event, '–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ (DWG)')" style="display:none">
                </div>

                <!-- 2. Layout PDF -->
                <div class="full-width" style="margin-top: 16px;">
                    <div class="form-section-title" style="margin-bottom: 10px;">–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ —Å
                        —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–æ–π –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è (PDF) <span class="required">*</span></div>

                    <div class="attachments-list" *ngIf="getDocsByType('–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ (PDF)').length > 0">
                        <div *ngFor="let doc of getDocsByType('–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ (PDF)')"
                            class="attachment-item">
                            <div class="attachment-info">
                                <span class="file-icon">üìÑ</span>
                                <span class="file-name" (click)="downloadDoc(doc)">{{ doc.name }}</span>
                            </div>
                            <button class="btn-delete-doc" (click)="deleteDoc(doc)" title="–£–¥–∞–ª–∏—Ç—å">√ó</button>
                        </div>
                    </div>

                    <div class="upload-placeholder" (click)="layoutPdfInput.click()"
                        *ngIf="getDocsByType('–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ (PDF)').length === 0">
                        <div class="upload-icon">üìÑ</div>
                        <div class="upload-text">–ó–∞–≥—Ä—É–∑–∏—Ç—å –ü–ª–∞–Ω–∏—Ä–æ–≤–∫—É</div>
                        <div class="upload-subtext">–¢–æ–ª—å–∫–æ PDF</div>
                    </div>
                    <input #layoutPdfInput type="file" accept=".pdf"
                        (change)="onTaskFileSelected($event, '–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ (PDF)')" style="display:none">
                </div>
            </ng-container>

            <!-- Custom Equipment Budget Fields -->
            <ng-container *ngIf="selectedTask.name === '–†–∞—Å—á–µ—Ç –±—é–¥–∂–µ—Ç–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è'">
                <div class="form-section-title">–ë—é–¥–∂–µ—Ç –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è</div>

                <div class="field-group">
                    <label>–°—É–º–º–∞ –∑–∞—Ç—Ä–∞—Ç –Ω–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ. —Ä—É–±. –±–µ–∑ –ù–î–° <span class="required">*</span></label>
                    <input type="number" [(ngModel)]="selectedTask.equipmentCostNoVat" class="modern-input"
                        placeholder="0.00">
                </div>

                <!-- 1. Equipment Budget XLS -->
                <div class="full-width" style="margin-top: 16px;">
                    <div class="form-section-title" style="margin-bottom: 10px;">–†–∞—Å—á–µ—Ç –∑–∞—Ç—Ä–∞—Ç –Ω–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ (XLS)
                        <span class="required">*</span>
                    </div>

                    <div class="attachments-list" *ngIf="getDocsByType('–†–∞—Å—á–µ—Ç –∑–∞—Ç—Ä–∞—Ç –Ω–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ').length > 0">
                        <div *ngFor="let doc of getDocsByType('–†–∞—Å—á–µ—Ç –∑–∞—Ç—Ä–∞—Ç –Ω–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ')" class="attachment-item">
                            <div class="attachment-info">
                                <span class="file-icon">üìä</span>
                                <span class="file-name" (click)="downloadDoc(doc)">{{ doc.name }}</span>
                            </div>
                            <button class="btn-delete-doc" (click)="deleteDoc(doc)" title="–£–¥–∞–ª–∏—Ç—å">√ó</button>
                        </div>
                    </div>

                    <div class="upload-placeholder" (click)="equipBudgetInput.click()"
                        *ngIf="getDocsByType('–†–∞—Å—á–µ—Ç –∑–∞—Ç—Ä–∞—Ç –Ω–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ').length === 0">
                        <div class="upload-icon">üìä</div>
                        <div class="upload-text">–ó–∞–≥—Ä—É–∑–∏—Ç—å –†–∞—Å—á–µ—Ç</div>
                        <div class="upload-subtext">–¢–æ–ª—å–∫–æ XLS/XLSX</div>
                    </div>
                    <input #equipBudgetInput type="file" accept=".xls,.xlsx"
                        (change)="onTaskFileSelected($event, '–†–∞—Å—á–µ—Ç –∑–∞—Ç—Ä–∞—Ç –Ω–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ')" style="display:none">
                </div>
            </ng-container>

            <!-- Custom Security Budget Fields -->
            <ng-container *ngIf="selectedTask.name === '–†–∞—Å—á–µ—Ç –±—é–¥–∂–µ—Ç–∞ –°–ë'">
                <div class="form-section-title">–ë—é–¥–∂–µ—Ç –°–ë</div>

                <div class="field-group">
                    <label>–°—É–º–º–∞ –±—é–¥–∂–µ—Ç–∞ –°–ë. —Ä—É–±. –±–µ–∑ –ù–î–° <span class="required">*</span></label>
                    <input type="number" [(ngModel)]="selectedTask.securityBudgetNoVat" class="modern-input"
                        placeholder="0.00">
                </div>

                <!-- 1. Security Questionnaire -->
                <div class="full-width" style="margin-top: 16px;">
                    <div class="form-section-title" style="margin-bottom: 10px;">–ê–Ω–∫–µ—Ç–∞ –°–ë <span
                            class="required">*</span></div>

                    <div class="attachments-list" *ngIf="getDocsByType('–ê–Ω–∫–µ—Ç–∞ –°–ë').length > 0">
                        <div *ngFor="let doc of getDocsByType('–ê–Ω–∫–µ—Ç–∞ –°–ë')" class="attachment-item">
                            <div class="attachment-info">
                                <span class="file-icon">üìù</span>
                                <span class="file-name" (click)="downloadDoc(doc)">{{ doc.name }}</span>
                            </div>
                            <button class="btn-delete-doc" (click)="deleteDoc(doc)" title="–£–¥–∞–ª–∏—Ç—å">√ó</button>
                        </div>
                    </div>

                    <div class="upload-placeholder" (click)="sbQuestInput.click()"
                        *ngIf="getDocsByType('–ê–Ω–∫–µ—Ç–∞ –°–ë').length === 0">
                        <div class="upload-icon">üìù</div>
                        <div class="upload-text">–ó–∞–≥—Ä—É–∑–∏—Ç—å –ê–Ω–∫–µ—Ç—É</div>
                    </div>
                    <input #sbQuestInput type="file" (change)="onTaskFileSelected($event, '–ê–Ω–∫–µ—Ç–∞ –°–ë')"
                        style="display:none">
                </div>

                <!-- 2. Security Budget Calculation XLS -->
                <div class="full-width" style="margin-top: 16px;">
                    <div class="form-section-title" style="margin-bottom: 10px;">–†–∞—Å—á–µ—Ç –∑–∞—Ç—Ä–∞—Ç –Ω–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –°–ë (XLS)
                        <span class="required">*</span>
                    </div>

                    <div class="attachments-list" *ngIf="getDocsByType('–†–∞—Å—á–µ—Ç –∑–∞—Ç—Ä–∞—Ç –Ω–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –°–ë').length > 0">
                        <div *ngFor="let doc of getDocsByType('–†–∞—Å—á–µ—Ç –∑–∞—Ç—Ä–∞—Ç –Ω–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –°–ë')"
                            class="attachment-item">
                            <div class="attachment-info">
                                <span class="file-icon">üìä</span>
                                <span class="file-name" (click)="downloadDoc(doc)">{{ doc.name }}</span>
                            </div>
                            <button class="btn-delete-doc" (click)="deleteDoc(doc)" title="–£–¥–∞–ª–∏—Ç—å">√ó</button>
                        </div>
                    </div>

                    <div class="upload-placeholder" (click)="sbBudgetInput.click()"
                        *ngIf="getDocsByType('–†–∞—Å—á–µ—Ç –∑–∞—Ç—Ä–∞—Ç –Ω–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –°–ë').length === 0">
                        <div class="upload-icon">üìä</div>
                        <div class="upload-text">–ó–∞–≥—Ä—É–∑–∏—Ç—å –†–∞—Å—á–µ—Ç</div>
                        <div class="upload-subtext">–¢–æ–ª—å–∫–æ XLS/XLSX</div>
                    </div>
                    <input #sbBudgetInput type="file" accept=".xls,.xlsx"
                        (change)="onTaskFileSelected($event, '–†–∞—Å—á–µ—Ç –∑–∞—Ç—Ä–∞—Ç –Ω–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –°–ë')" style="display:none">
                </div>
            </ng-container>

            <!-- Custom RSR Budget Fields -->
            <ng-container *ngIf="selectedTask.name === '–¢–ó –∏ —Ä–∞—Å—á–µ—Ç –±—é–¥–∂–µ—Ç–∞ –†–°–†'">
                <div class="form-section-title">–ë—é–¥–∂–µ—Ç –†–°–†</div>

                <div class="field-group">
                    <label>–°—É–º–º–∞ –±—é–¥–∂–µ—Ç–∞ –†–°–†. —Ä—É–±. –±–µ–∑ –ù–î–° <span class="required">*</span></label>
                    <input type="number" [(ngModel)]="selectedTask.rsrBudgetNoVat" class="modern-input"
                        placeholder="0.00">
                </div>

                <!-- 1. Distribution List -->
                <div class="full-width" style="margin-top: 16px;">
                    <div class="form-section-title" style="margin-bottom: 10px;">–†–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç–µ–ª—å–Ω–∞—è –≤–µ–¥–æ–º–æ—Å—Ç—å <span
                            class="required">*</span></div>

                    <div class="attachments-list" *ngIf="getDocsByType('–†–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç–µ–ª—å–Ω–∞—è –≤–µ–¥–æ–º–æ—Å—Ç—å').length > 0">
                        <div *ngFor="let doc of getDocsByType('–†–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç–µ–ª—å–Ω–∞—è –≤–µ–¥–æ–º–æ—Å—Ç—å')" class="attachment-item">
                            <div class="attachment-info">
                                <span class="file-icon">üìã</span>
                                <span class="file-name" (click)="downloadDoc(doc)">{{ doc.name }}</span>
                            </div>
                            <button class="btn-delete-doc" (click)="deleteDoc(doc)" title="–£–¥–∞–ª–∏—Ç—å">√ó</button>
                        </div>
                    </div>

                    <div class="upload-placeholder" (click)="distListInput.click()"
                        *ngIf="getDocsByType('–†–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç–µ–ª—å–Ω–∞—è –≤–µ–¥–æ–º–æ—Å—Ç—å').length === 0">
                        <div class="upload-icon">üìã</div>
                        <div class="upload-text">–ó–∞–≥—Ä—É–∑–∏—Ç—å –í–µ–¥–æ–º–æ—Å—Ç—å</div>
                    </div>
                    <input #distListInput type="file"
                        (change)="onTaskFileSelected($event, '–†–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç–µ–ª—å–Ω–∞—è –≤–µ–¥–æ–º–æ—Å—Ç—å')" style="display:none">
                </div>

                <!-- 2. Technical Assignment (Optional) -->
                <div class="full-width" style="margin-top: 16px;">
                    <div class="form-section-title" style="margin-bottom: 10px;">–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ</div>

                    <div class="attachments-list" *ngIf="getDocsByType('–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ').length > 0">
                        <div *ngFor="let doc of getDocsByType('–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ')" class="attachment-item">
                            <div class="attachment-info">
                                <span class="file-icon">üìù</span>
                                <span class="file-name" (click)="downloadDoc(doc)">{{ doc.name }}</span>
                            </div>
                            <button class="btn-delete-doc" (click)="deleteDoc(doc)" title="–£–¥–∞–ª–∏—Ç—å">√ó</button>
                        </div>
                    </div>

                    <div class="upload-placeholder" (click)="techAssInput.click()">
                        <div class="upload-icon">üìù</div>
                        <div class="upload-text">–ó–∞–≥—Ä—É–∑–∏—Ç—å –¢–ó</div>
                        <div class="upload-subtext">–ù–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ</div>
                    </div>
                    <input #techAssInput type="file" (change)="onTaskFileSelected($event, '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ')"
                        style="display:none">
                </div>

                <!-- 3. RSR Budget Calculation (XLS) -->
                <div class="full-width" style="margin-top: 16px;">
                    <div class="form-section-title" style="margin-bottom: 10px;">–†–∞—Å—á–µ—Ç –±—é–¥–∂–µ—Ç–∞ –†–°–† (XLS) <span
                            class="required">*</span></div>

                    <div class="attachments-list" *ngIf="getDocsByType('–†–∞—Å—á–µ—Ç –±—é–¥–∂–µ—Ç–∞ –†–°–†').length > 0">
                        <div *ngFor="let doc of getDocsByType('–†–∞—Å—á–µ—Ç –±—é–¥–∂–µ—Ç–∞ –†–°–†')" class="attachment-item">
                            <div class="attachment-info">
                                <span class="file-icon">üìä</span>
                                <span class="file-name" (click)="downloadDoc(doc)">{{ doc.name }}</span>
                            </div>
                            <button class="btn-delete-doc" (click)="deleteDoc(doc)" title="–£–¥–∞–ª–∏—Ç—å">√ó</button>
                        </div>
                    </div>

                    <div class="upload-placeholder" (click)="rsrBudgetInput.click()"
                        *ngIf="getDocsByType('–†–∞—Å—á–µ—Ç –±—é–¥–∂–µ—Ç–∞ –†–°–†').length === 0">
                        <div class="upload-icon">üìä</div>
                        <div class="upload-text">–ó–∞–≥—Ä—É–∑–∏—Ç—å –†–∞—Å—á–µ—Ç</div>
                        <div class="upload-subtext">–¢–æ–ª—å–∫–æ XLS/XLSX</div>
                    </div>
                    <input #rsrBudgetInput type="file" accept=".xls,.xlsx"
                        (change)="onTaskFileSelected($event, '–†–∞—Å—á–µ—Ç –±—é–¥–∂–µ—Ç–∞ –†–°–†')" style="display:none">
                </div>
            </ng-container>

            <!-- Custom PIS Budget Fields -->
            <ng-container *ngIf="selectedTask.name === '–†–∞—Å—á–µ—Ç –±—é–¥–∂–µ—Ç–∞ –ü–∏–°'">
                <div class="form-section-title">–ë—é–¥–∂–µ—Ç –ü–ò–°</div>

                <div class="field-group">
                    <label>–°—É–º–º–∞ –±—é–¥–∂–µ—Ç–∞ –ü–ò–°. —Ä—É–±. –±–µ–∑ –ù–î–° <span class="required">*</span></label>
                    <input type="number" [(ngModel)]="selectedTask.pisBudgetNoVat" class="modern-input"
                        placeholder="0.00">
                </div>

                <!-- 1. PIS Budget Calculation (XLS, Optional) -->
                <div class="full-width" style="margin-top: 16px;">
                    <div class="form-section-title" style="margin-bottom: 10px;">–†–∞—Å—á–µ—Ç –±—é–¥–∂–µ—Ç–∞ –ü–ò–° (XLS)</div>

                    <div class="attachments-list" *ngIf="getDocsByType('–†–∞—Å—á–µ—Ç –±—é–¥–∂–µ—Ç–∞ –ü–ò–°').length > 0">
                        <div *ngFor="let doc of getDocsByType('–†–∞—Å—á–µ—Ç –±—é–¥–∂–µ—Ç–∞ –ü–ò–°')" class="attachment-item">
                            <div class="attachment-info">
                                <span class="file-icon">üìä</span>
                                <span class="file-name" (click)="downloadDoc(doc)">{{ doc.name }}</span>
                            </div>
                            <button class="btn-delete-doc" (click)="deleteDoc(doc)" title="–£–¥–∞–ª–∏—Ç—å">√ó</button>
                        </div>
                    </div>

                    <div class="upload-placeholder" (click)="pisBudgetInput.click()"
                        *ngIf="getDocsByType('–†–∞—Å—á–µ—Ç –±—é–¥–∂–µ—Ç–∞ –ü–ò–°').length === 0">
                        <div class="upload-icon">üìä</div>
                        <div class="upload-text">–ó–∞–≥—Ä—É–∑–∏—Ç—å –†–∞—Å—á–µ—Ç</div>
                        <div class="upload-subtext">–ù–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, —Ç–æ–ª—å–∫–æ XLS/XLSX</div>
                    </div>
                    <input #pisBudgetInput type="file" accept=".xls,.xlsx"
                        (change)="onTaskFileSelected($event, '–†–∞—Å—á–µ—Ç –±—é–¥–∂–µ—Ç–∞ –ü–ò–°')" style="display:none">
                </div>
            </ng-container>

            <!-- Custom General Project Budget Fields -->
            <ng-container *ngIf="selectedTask.name === '–û–±—â–∏–π –±—é–¥–∂–µ—Ç –ø—Ä–æ–µ–∫—Ç–∞'">
                <div class="form-section-title">–û–±—â–∏–π –±—é–¥–∂–µ—Ç</div>

                <div class="field-group">
                    <label>–°—É–º–º–∞ –æ–±—â–µ–≥–æ –±—é–¥–∂–µ—Ç–∞. —Ä—É–±. –±–µ–∑ –ù–î–° <span class="required">*</span></label>
                    <input type="number" [(ngModel)]="selectedTask.totalBudgetNoVat" class="modern-input"
                        placeholder="0.00">
                </div>
            </ng-container>

            <!-- Activity Log / Metadata (Readonly) -->
            <div class="form-section-title">–•—Ä–æ–Ω–æ–ª–æ–≥–∏—è</div>

            <div class="field-group" *ngIf="selectedTask.createdAt">
                <label>–ù–∞–∑–Ω–∞—á–µ–Ω–æ</label>
                <div class="modern-input" style="background:#f8fafc; border:none; color:#64748b;">
                    {{ selectedTask.createdAt | date:'dd.MM.yyyy HH:mm' }}
                </div>
            </div>

            <div class="field-group" *ngIf="selectedTask.startedAt">
                <label>–í–∑—è—Ç–æ –≤ —Ä–∞–±–æ—Ç—É</label>
                <div class="modern-input" style="background:#f8fafc; border:none; color:#64748b;">
                    {{ selectedTask.startedAt | date:'dd.MM.yyyy HH:mm' }}
                </div>
            </div>

            <div class="field-group" *ngIf="selectedTask.completedAt">
                <label>–ó–∞–≤–µ—Ä—à–µ–Ω–æ</label>
                <div class="modern-input" style="background:#f8fafc; border:none; color:#64748b;">
                    {{ selectedTask.completedAt | date:'dd.MM.yyyy HH:mm' }}
                </div>
            </div>

            <!-- Attachments -->
            <div class="form-section-title">–í–ª–æ–∂–µ–Ω–∏—è</div>

            <!-- Special handling for '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∞—É–¥–∏—Ç—É' -->
            <ng-container *ngIf="selectedTask.name === '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∞—É–¥–∏—Ç—É'; else defaultAttachments">

                <!-- 1. Technical Plan -->
                <div class="full-width" style="margin-bottom: 20px;">
                    <div class="form-section-title" style="margin-bottom: 10px;">–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω <span
                            class="required">*</span></div>

                    <div class="upload-placeholder" (click)="techPlanInput.click()"
                        *ngIf="getDocsByType('–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω').length === 0">
                        <div class="upload-icon">üìÇ</div>
                        <div class="upload-text">–ó–∞–≥—Ä—É–∑–∏—Ç—å –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω</div>
                        <div class="upload-subtext">–§–∞–π–ª .pdf, .dwg</div>
                    </div>

                    <div class="attachments-list" *ngIf="getDocsByType('–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω').length > 0">
                        <div *ngFor="let doc of getDocsByType('–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω')" class="attachment-item tech-plan">
                            <div class="attachment-info">
                                <span class="file-icon">üìë</span>
                                <span class="file-name" (click)="downloadDoc(doc)">{{ doc.name }}</span>
                            </div>
                            <button class="btn-delete-doc" (click)="deleteDoc(doc)" title="–£–¥–∞–ª–∏—Ç—å">√ó</button>
                        </div>
                    </div>

                    <input #techPlanInput type="file" (change)="onTaskFileSelected($event, '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω')"
                        style="display:none">
                </div>

                <!-- 2. Additional Docs -->
                <div class="full-width">
                    <div class="form-section-title" style="margin-bottom: 10px;">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã</div>

                    <div class="attachments-list" *ngIf="getDocsExcludeType('–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω').length > 0">
                        <div *ngFor="let doc of getDocsExcludeType('–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω')" class="attachment-item">
                            <div class="attachment-info">
                                <span class="file-icon">üìé</span>
                                <span class="file-name" (click)="downloadDoc(doc)">{{ doc.name }}</span>
                            </div>
                            <button class="btn-delete-doc" (click)="deleteDoc(doc)">√ó</button>
                        </div>
                    </div>

                    <div class="upload-placeholder" (click)="addDocInput.click()"
                        style="margin-top: 10px; border-style: dashed; padding: 12px; min-height: 0;">
                        <span class="upload-text" style="color:#64748b; font-size:12px;">+ –î–æ–±–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç</span>
                    </div>

                    <input #addDocInput type="file" (change)="onTaskFileSelected($event, '–í–ª–æ–∂–µ–Ω–∏–µ –∫ –∑–∞–¥–∞—á–µ')"
                        style="display:none">
                </div>
            </ng-container>

            <!-- Default Attachments -->
            <ng-template #defaultAttachments>
                <div class="full-width">
                    <div class="attachments-list" *ngIf="taskDocuments.length > 0">
                        <div *ngFor="let doc of taskDocuments" class="attachment-item">
                            <div class="attachment-info">
                                <span class="file-icon">üìé</span>
                                <span class="file-name" (click)="downloadDoc(doc)">{{ doc.name }}</span>
                            </div>
                            <button class="btn-delete-doc" (click)="deleteDoc(doc)">√ó</button>
                        </div>
                    </div>

                    <div class="upload-placeholder" (click)="defaultInput.click()" style="margin-top: 10px;">
                        <div class="upload-icon">‚òÅÔ∏è</div>
                        <div class="upload-text">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª—ã</div>
                        <div class="upload-subtext">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</div>
                    </div>
                    <input #defaultInput type="file" (change)="onTaskFileSelected($event)" style="display:none">
                </div>
            </ng-template>
        </div>

        <div class="modal-actions">
            <button class="btn-secondary" (click)="closeEditTaskModal()">–û—Ç–º–µ–Ω–∞</button>
            <button *ngIf="selectedTask && selectedTask.status === '–ù–∞–∑–Ω–∞—á–µ–Ω–∞'" class="btn-action-start"
                (click)="selectedTask && startTask(selectedTask); closeEditTaskModal()">
                ‚ñ∂ –í–∑—è—Ç—å –≤ —Ä–∞–±–æ—Ç—É
            </button>
            <button *ngIf="selectedTask && selectedTask.status === '–í —Ä–∞–±–æ—Ç–µ'" class="btn-action-complete"
                (click)="selectedTask && completeTask(selectedTask)">
                ‚úì –ó–∞–≤–µ—Ä—à–∏—Ç—å
            </button>
            <button class="btn-primary" (click)="saveTaskChanges()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>
</div>
```
<!-- Gantt Task Info Modal -->
<div class="modal-overlay" *ngIf="showGanttTaskInfoModal" (click)="closeGanttTaskInfo()">
    <div class="modal-content gantt-task-modal" (click)="$event.stopPropagation()"
        style="max-width: 600px; width: 100%; padding: 24px; border-radius: 16px; background: white; box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);">
        <div class="modal-header-compact"
            style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 24px;">
            <h2 style="font-size: 20px; font-weight: 700; color: #0f172a; margin: 0; line-height: 1.4;">{{
                ganttSelectedTask?.name }}</h2>
            <button class="btn-close-modal" (click)="closeGanttTaskInfo()"
                style="background: none; border: none; font-size: 24px; color: #94a3b8; cursor: pointer; line-height: 1; padding: 0;">√ó</button>
        </div>

        <div class="task-info-grid" *ngIf="ganttSelectedTask"
            style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px;">

            <!-- Cards -->
            <div class="info-card-item"
                style="background: #f8fafc; border-radius: 12px; padding: 16px; display: flex; align-items: center; gap: 16px; border: 1px solid #e2e8f0;">
                <div class="icon-wrapper"
                    style="width: 44px; height: 44px; background: white; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">
                    üìã
                </div>
                <div>
                    <div
                        style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 700; letter-spacing: 0.5px;">
                        –¢–∏–ø –∑–∞–¥–∞—á–∏</div>
                    <div style="font-size: 14px; font-weight: 600; color: #0f172a; margin-top: 2px;">UserTask</div>
                </div>
            </div>

            <div class="info-card-item"
                style="background: #f8fafc; border-radius: 12px; padding: 16px; display: flex; align-items: center; gap: 16px; border: 1px solid #e2e8f0;">
                <div class="icon-wrapper"
                    style="width: 44px; height: 44px; background: white; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">
                    üë§
                </div>
                <div>
                    <div
                        style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 700; letter-spacing: 0.5px;">
                        –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π</div>
                    <div style="font-size: 14px; font-weight: 600; color: #0f172a; margin-top: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 140px;"
                        title="{{ getResponsibleDisplay(ganttSelectedTask) }}">{{
                        getResponsibleDisplay(ganttSelectedTask) }}</div>
                </div>
            </div>

            <div class="info-card-item"
                style="background: #f8fafc; border-radius: 12px; padding: 16px; display: flex; align-items: center; gap: 16px; border: 1px solid #e2e8f0;">
                <div class="icon-wrapper"
                    style="width: 44px; height: 44px; background: white; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">
                    üóìÔ∏è
                </div>
                <div>
                    <div
                        style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 700; letter-spacing: 0.5px;">
                        –ü–ª–∞–Ω–æ–≤—ã–π —Å—Ä–æ–∫</div>
                    <div style="font-size: 14px; font-weight: 600; color: #0f172a; margin-top: 2px;">{{
                        ganttSelectedTask.normativeDeadline | date:'dd.MM.yyyy' }}</div>
                </div>
            </div>

            <div class="info-card-item"
                style="background: #f8fafc; border-radius: 12px; padding: 16px; display: flex; align-items: center; gap: 16px; border: 1px solid #e2e8f0;">
                <div class="icon-wrapper"
                    style="width: 44px; height: 44px; background: white; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">
                    üöÄ
                </div>
                <div>
                    <div
                        style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 700; letter-spacing: 0.5px;">
                        –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞</div>
                    <div style="font-size: 14px; font-weight: 600; color: #0f172a; margin-top: 2px;">
                        {{ (ganttSelectedTask.startedAt || ganttSelectedTask.createdAt) | date:'dd.MM.yyyy' }}
                    </div>
                </div>
            </div>
        </div>

        <div class="modal-actions-compact" style="display: flex; justify-content: flex-end; gap: 12px;">
            <button class="btn-primary"
                *ngIf="ganttSelectedTask && ganttSelectedTask.isActive && canEditTask(ganttSelectedTask)"
                (click)="ganttSelectedTask && openEditTaskModal(ganttSelectedTask); closeGanttTaskInfo()"
                style="border-radius: 8px; padding: 10px 20px; font-size: 14px; background: #3b82f6; color: white; border: none; cursor: pointer;">
                –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
            </button>
            <button class="btn-cancel" (click)="closeGanttTaskInfo()"
                style="background: #f1f5f9; color: #475569; border: none; border-radius: 8px; padding: 10px 20px; font-weight: 600; font-size: 14px; cursor: pointer;">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>
</div>